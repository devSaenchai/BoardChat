<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BoardChat</title>

<style>
body{
 margin:0;
 background:#111;
 overflow:hidden;
 touch-action:none;
}
canvas{
 background:black;
 display:block;
}
#toolbar{
 position:fixed;
 top:10px;
 left:50%;
 transform:translateX(-50%);
 z-index:10;
}
button{
 font-size:16px;
 padding:10px;
 margin:3px;
 border:none;
 border-radius:8px;
}
</style>
</head>

<body>

<div id="toolbar">
<button onclick="tool='draw'">‚úèÔ∏è Pencil</button>
<button onclick="tool='erase'">üßΩ Eraser</button>
</div>

<canvas id="board"></canvas>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyD_irdW_k6Hmp7PLzP9j7rKgWks9yya8xo",
 authDomain: "boardchat-e9cfb.firebaseapp.com",
 databaseURL: "https://boardchat-e9cfb-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "boardchat-e9cfb",
 storageBucket: "boardchat-e9cfb.firebasestorage.app",
 messagingSenderId: "934254339524",
 appId: "1:934254339524:web:4abd1c01064be680b57091"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const strokesRef = ref(db,"board");

const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let drawing=false;
let tool="draw";
let lastX=null;
let lastY=null;

function drawStroke(x,y,t){

 if(lastX===null){
   lastX=x;
   lastY=y;
 }

 ctx.beginPath();
 ctx.moveTo(lastX,lastY);
 ctx.lineTo(x,y);
 ctx.lineCap="round";
 ctx.lineWidth=(t==="erase")?30:4;

 if(t==="erase"){
   ctx.globalCompositeOperation="destination-out";
 }else{
   ctx.globalCompositeOperation="source-over";
   ctx.strokeStyle="white";
 }

 ctx.stroke();

 lastX=x;
 lastY=y;
}

function send(x,y,t){
 push(strokesRef,{
  x:x,
  y:y,
  tool:t
 });
}

onChildAdded(strokesRef,(snap)=>{
 let d=snap.val();
 drawStroke(d.x,d.y,d.tool);
});

canvas.addEventListener("touchstart",()=>{
 drawing=true;
 lastX=null;
 lastY=null;
});

canvas.addEventListener("touchend",()=>{
 drawing=false;
 lastX=null;
 lastY=null;
});

canvas.addEventListener("touchmove",(e)=>{
 if(!drawing)return;

 let rect=canvas.getBoundingClientRect();
 let x=e.touches[0].clientX-rect.left;
 let y=e.touches[0].clientY-rect.top;

 drawStroke(x,y,tool);
 send(x,y,tool);
});

</script>

</body>
</html>
