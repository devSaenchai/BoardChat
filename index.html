<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BoardChat</title>

<style>
body{
margin:0;
background:black;
display:flex;
flex-direction:column;
align-items:center;
font-family:sans-serif;
color:white;
}
button{
margin:10px;
padding:10px 20px;
font-size:16px;
border:none;
border-radius:10px;
}
canvas{
background:black;
touch-action:none;
}
</style>
</head>

<body>

<button id="clear">ðŸ§¹ Clear Board</button>

<canvas id="board" width="360" height="600"></canvas>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyD_irdW_k6Hmp7PLzP9j7rKgWks9yya8xo",
authDomain:"boardchat-e9cfb.firebaseapp.com",
databaseURL:"https://boardchat-e9cfb-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"boardchat-e9cfb",
storageBucket:"boardchat-e9cfb.firebasestorage.app",
messagingSenderId:"934254339524",
appId:"1:934254339524:web:4abd1c01064be680b57091"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");

ctx.strokeStyle="white";
ctx.lineWidth=4;
ctx.lineCap="round";

const userId=crypto.randomUUID();

let drawing=false;
let strokeId=null;
let currentStroke=[];

function getPos(e){
const rect=canvas.getBoundingClientRect();
return{
x:e.clientX-rect.left,
y:e.clientY-rect.top
};
}

canvas.addEventListener("pointerdown",e=>{
drawing=true;
strokeId=userId+"_"+Date.now();
currentStroke=[];
});

canvas.addEventListener("pointermove",e=>{
if(!drawing)return;

const pos=getPos(e);
currentStroke.push(pos);

set(ref(db,"boards/mainBoard/strokes/"+strokeId),{
user:userId,
points:currentStroke
});
});

canvas.addEventListener("pointerup",()=>drawing=false);
canvas.addEventListener("pointerleave",()=>drawing=false);

onValue(ref(db,"boards/mainBoard/strokes"),snap=>{

ctx.clearRect(0,0,canvas.width,canvas.height);

snap.forEach(child=>{
const pts=child.val().points;
if(!pts)return;

ctx.beginPath();

for(let i=0;i<pts.length;i++){
if(i===0)ctx.moveTo(pts[i].x,pts[i].y);
else ctx.lineTo(pts[i].x,pts[i].y);
}

ctx.stroke();
});

});

document.getElementById("clear").onclick=()=>{
remove(ref(db,"boards/mainBoard/strokes"));
};

</script>

</body>
</html>
